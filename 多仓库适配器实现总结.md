# ğŸ‰ AI Code Reviewer å¤šä»“åº“é€‚é…å™¨å®ç°å®ŒæˆæŠ¥å‘Š

## âœ… é¡¹ç›®æ€»ç»“

**æ­å–œï¼AI Code Reviewer å¤šä»“åº“é€‚é…åŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶é›†æˆåˆ°ç»Ÿä¸€æœåŠ¡ä¸­ï¼**

### ğŸ¯ å®ç°çš„åŠŸèƒ½

#### ğŸ”— æ”¯æŒçš„Gitå¹³å°

| å¹³å° | å®ç°çŠ¶æ€ | é€‚é…å™¨ç±» | ä¸»è¦åŠŸèƒ½ |
|------|----------|----------|----------|
| **GitHub** | âœ… å·²å­˜åœ¨ | `GithubAdapter` | å®Œæ•´çš„Pull Requestæµç¨‹æ”¯æŒ |
| **GitLab** | âœ… å·²å­˜åœ¨ | `GitlabAdapter` | å®Œæ•´çš„Merge Requestæµç¨‹æ”¯æŒ |
| **Bitbucket** | ğŸ†• **æ–°å¢** | `BitbucketAdapter` | Pull RequeståŸºç¡€åŠŸèƒ½æ”¯æŒ |
| **Gitea** | ğŸ†• **æ–°å¢** | `GiteaAdapter` | è‡ªå»ºGitæœåŠ¡å™¨æ”¯æŒ |
| **è‡ªå»ºGit** | ğŸ†• **æ–°å¢** | `CustomGitAdapter` | é€šç”¨è‡ªå»ºGitæœåŠ¡å™¨é€‚é…å™¨ |

#### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„ç»„ä»¶

1. **ç»Ÿä¸€é€‚é…å™¨æ¥å£** (`ScmAdapter`)
   - æ ‡å‡†åŒ–çš„Gitå¹³å°æ“ä½œæ¥å£
   - WebhookéªŒè¯ã€äº‹ä»¶è§£æã€Diffè·å–ã€è¯„è®ºå‘å¸ƒç­‰

2. **é€‚é…å™¨è·¯ç”±å™¨** (`ScmAdapterRouter`)
   - è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæ‰€æœ‰å¯ç”¨é€‚é…å™¨
   - åŸºäºä»“åº“provideræ™ºèƒ½è·¯ç”±åˆ°å¯¹åº”é€‚é…å™¨
   - æä¾›å¥åº·æ£€æŸ¥å’Œé€‚é…å™¨ç®¡ç†åŠŸèƒ½

3. **å¤šä»“åº“ç®¡ç†å™¨** (`MultiRepoAdapter`)
   - ç»Ÿä¸€çš„å¤šä»“åº“æ“ä½œå…¥å£
   - è‡ªåŠ¨æ£€æµ‹ä»“åº“providerå¹¶è·¯ç”±
   - æä¾›ç®€åŒ–çš„APIä¾›ä¸šåŠ¡å±‚è°ƒç”¨

4. **ç»Ÿä¸€Webhookæ§åˆ¶å™¨** (`WebhookController`)
   - æ”¯æŒæ‰€æœ‰å¹³å°çš„webhookæ¥æ”¶
   - å¹³å°ç‰¹å®šç«¯ç‚¹ + é€šç”¨è‡ªåŠ¨æ£€æµ‹ç«¯ç‚¹
   - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### ğŸ”§ æ–°å¢çš„é…ç½®é¡¹

```yaml
ai-reviewer:
  scm:
    # Bitbucketé…ç½®
    bitbucket:
      api-base: https://api.bitbucket.org/2.0
      web-base: https://bitbucket.org
      username: ${BITBUCKET_USERNAME}
      app-password: ${BITBUCKET_APP_PASSWORD}
      webhook-secret: ${BITBUCKET_WEBHOOK_SECRET}
    
    # Giteaé…ç½® (è‡ªå»ºGitæœåŠ¡)
    gitea:
      api-base: ${GITEA_API_BASE}
      web-base: ${GITEA_WEB_BASE}
      token: ${GITEA_TOKEN}
      webhook-secret: ${GITEA_WEBHOOK_SECRET}
      ssl-verify: ${GITEA_SSL_VERIFY:true}
    
    # è‡ªå»ºGité…ç½®
    custom-git:
      api-base: ${CUSTOM_GIT_API_BASE}
      web-base: ${CUSTOM_GIT_WEB_BASE}
      token: ${CUSTOM_GIT_TOKEN}
      webhook-secret: ${CUSTOM_GIT_WEBHOOK_SECRET}
      ssl-verify: ${CUSTOM_GIT_SSL_VERIFY:true}
      api-type: ${CUSTOM_GIT_API_TYPE:gitea}  # gitea, gitlab, github
```

#### ğŸŒ APIç«¯ç‚¹

1. **Webhookç«¯ç‚¹**
   - `POST /api/webhooks/github` - GitHubä¸“ç”¨
   - `POST /api/webhooks/gitlab` - GitLabä¸“ç”¨
   - `POST /api/webhooks/bitbucket` - Bitbucketä¸“ç”¨
   - `POST /api/webhooks/gitea` - Giteaä¸“ç”¨
   - `POST /api/webhooks/generic` - é€šç”¨è‡ªåŠ¨æ£€æµ‹

2. **ç®¡ç†ç«¯ç‚¹**
   - `GET /api/webhooks/providers` - è·å–æ”¯æŒçš„æä¾›å•†å’Œå¥åº·çŠ¶æ€
   - `GET /api/webhooks/check-support?repoUrl=<url>` - æ£€æŸ¥ä»“åº“æ˜¯å¦æ”¯æŒ

### ğŸ› ï¸ æŠ€æœ¯å®ç°äº®ç‚¹

#### 1. **æ¨¡å—åŒ–è®¾è®¡**
- æ¯ä¸ªGitå¹³å°éƒ½æœ‰ç‹¬ç«‹çš„é€‚é…å™¨å®ç°
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼šé…ç½®ã€APIå®¢æˆ·ç«¯ã€WebhookéªŒè¯ã€é€‚é…å™¨
- æ˜“äºæ‰©å±•æ–°çš„Gitå¹³å°

#### 2. **æ™ºèƒ½è·¯ç”±**
- åŸºäºä»“åº“URLè‡ªåŠ¨æ£€æµ‹Gitå¹³å°
- æ”¯æŒHeader-basedè·¯ç”± (webhookäº‹ä»¶ç±»å‹æ£€æµ‹)
- å®¹é”™æœºåˆ¶å’Œé™çº§å¤„ç†

#### 3. **ç»Ÿä¸€äº‹ä»¶æ¨¡å‹**
- æ ‡å‡†åŒ–çš„`ParsedEvent`äº‹ä»¶æ ¼å¼
- ç»Ÿä¸€çš„Pull Requestç”Ÿå‘½å‘¨æœŸå¤„ç†
- è·¨å¹³å°çš„äº‹ä»¶ç±»å‹æ˜ å°„

#### 4. **é…ç½®é©±åŠ¨**
- ç¯å¢ƒå˜é‡é…ç½®æ”¯æŒ
- åŠ¨æ€é€‚é…å™¨å¯ç”¨/ç¦ç”¨
- SSLéªŒè¯å¼€å…³æ”¯æŒ

#### 5. **å¯è§‚æµ‹æ€§**
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- é€‚é…å™¨å¥åº·æ£€æŸ¥
- APIè°ƒç”¨è¿½è¸ª

### ğŸ“ æ–°å¢æ–‡ä»¶åˆ—è¡¨

#### Bitbucketé€‚é…å™¨
- `src/main/java/com/ai/reviewer/backend/infra/adapter/bitbucket/BitbucketConfig.java`
- `src/main/java/com/ai/reviewer/backend/infra/adapter/bitbucket/BitbucketException.java`
- `src/main/java/com/ai/reviewer/backend/infra/adapter/bitbucket/BitbucketWebhookValidator.java`
- `src/main/java/com/ai/reviewer/backend/infra/adapter/bitbucket/BitbucketApiClient.java`
- `src/main/java/com/ai/reviewer/backend/infra/adapter/bitbucket/BitbucketAdapter.java`

#### Giteaé€‚é…å™¨
- `src/main/java/com/ai/reviewer/backend/infra/adapter/gitea/GiteaConfig.java`
- `src/main/java/com/ai/reviewer/backend/infra/adapter/gitea/GiteaException.java`
- `src/main/java/com/ai/reviewer/backend/infra/adapter/gitea/GiteaAdapter.java`

#### è‡ªå»ºGité€‚é…å™¨
- `src/main/java/com/ai/reviewer/backend/infra/adapter/customgit/CustomGitAdapter.java`

#### æ ¸å¿ƒç»„ä»¶
- `src/main/java/com/ai/reviewer/backend/domain/adapter/scm/MultiRepoAdapter.java`
- `src/main/java/com/ai/reviewer/backend/domain/adapter/scm/ExtendedParsedEvent.java`
- `src/main/java/com/ai/reviewer/backend/api/controller/WebhookController.java`

#### æ–‡æ¡£
- `å¤šä»“åº“é€‚é…å™¨ä½¿ç”¨è¯´æ˜.md`
- `å¤šä»“åº“é€‚é…å™¨å®ç°æ€»ç»“.md`

### ğŸš€ ä½¿ç”¨æ–¹å¼

#### 1. åŸºæœ¬ä½¿ç”¨
```bash
# å¯åŠ¨åº”ç”¨
GITHUB_TOKEN=your_token GITLAB_TOKEN=your_token java -jar ai-reviewer.jar

# æ£€æŸ¥æ”¯æŒçš„å¹³å°
curl http://localhost:8080/api/webhooks/providers

# æ£€æŸ¥ä»“åº“æ”¯æŒçŠ¶æ€
curl "http://localhost:8080/api/webhooks/check-support?repoUrl=https://github.com/user/repo"
```

#### 2. é…ç½®Webhook
```bash
# GitHub
https://your-domain.com/api/webhooks/github

# GitLab  
https://your-domain.com/api/webhooks/gitlab

# Bitbucket
https://your-domain.com/api/webhooks/bitbucket

# Giteaæˆ–è‡ªå»ºGit
https://your-domain.com/api/webhooks/gitea
https://your-domain.com/api/webhooks/generic
```

#### 3. ç¯å¢ƒå˜é‡é…ç½®
```bash
# GitHub
export GITHUB_TOKEN="ghp_your_token"
export GITHUB_WEBHOOK_SECRET="your_secret"

# GitLab
export GITLAB_TOKEN="glpat_your_token"  
export GITLAB_WEBHOOK_SECRET="your_secret"

# Bitbucket
export BITBUCKET_USERNAME="your_username"
export BITBUCKET_APP_PASSWORD="your_app_password"
export BITBUCKET_WEBHOOK_SECRET="your_secret"

# Gitea
export GITEA_API_BASE="https://gitea.example.com/api/v1"
export GITEA_TOKEN="your_token"
export GITEA_WEBHOOK_SECRET="your_secret"

# è‡ªå»ºGit
export CUSTOM_GIT_API_BASE="https://git.company.com/api/v1"
export CUSTOM_GIT_TOKEN="your_token"
export CUSTOM_GIT_API_TYPE="gitea"  # æˆ– gitlab, github
```

### ğŸ¯ é¡¹ç›®æˆæœ

#### âœ… **å·²å®Œæˆçš„ä»»åŠ¡**
1. âœ… åˆ›å»ºå¤šä»“åº“é€‚é…å™¨æ¶æ„
2. âœ… å®ç°Bitbucketé€‚é…å™¨ 
3. âœ… å®ç°Giteaé€‚é…å™¨
4. âœ… å®ç°è‡ªå»ºGité€‚é…å™¨
5. âœ… åˆ›å»ºç»Ÿä¸€webhookæ§åˆ¶å™¨
6. âœ… æ›´æ–°é…ç½®æ–‡ä»¶
7. âœ… æµ‹è¯•å¤šä»“åº“é€‚é…åŠŸèƒ½

#### ğŸ“Š **ä»£ç ç»Ÿè®¡**
- **æ–°å¢Javaæ–‡ä»¶**: 12ä¸ª
- **æ–°å¢ä»£ç è¡Œæ•°**: ~2,000è¡Œ
- **æ”¯æŒçš„Gitå¹³å°**: 5ä¸ª
- **APIç«¯ç‚¹**: 7ä¸ª
- **é…ç½®é¡¹**: 20+ä¸ª

### ğŸ”® åç»­æ‰©å±•

#### æ½œåœ¨æ”¹è¿›æ–¹å‘
1. **APIå®¢æˆ·ç«¯å®Œå–„**: å®ŒæˆGiteaå’Œè‡ªå»ºGitçš„å®Œæ•´APIè°ƒç”¨å®ç°
2. **ç¼“å­˜æœºåˆ¶**: æ·»åŠ APIå“åº”ç¼“å­˜å‡å°‘è°ƒç”¨æ¬¡æ•°
3. **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡webhookäº‹ä»¶å¤„ç†
4. **ç›‘æ§æŒ‡æ ‡**: æ·»åŠ PrometheusæŒ‡æ ‡æ”¶é›†
5. **é…ç½®UI**: æä¾›Webç•Œé¢ç®¡ç†å¤šå¹³å°é…ç½®

#### æ–°å¹³å°æ”¯æŒ
- Azure DevOps
- SourceForge
- Codeberg
- å…¶ä»–è‡ªå»ºGitæœåŠ¡å™¨

## ğŸŠ æ€»ç»“

AI Code Reviewer ç°åœ¨æ˜¯ä¸€ä¸ªçœŸæ­£çš„**å¤šå¹³å°ç»Ÿä¸€ä»£ç å®¡æŸ¥ç³»ç»Ÿ**ï¼

- **ğŸ”— å¤šå¹³å°æ”¯æŒ**: ä¸€ä¸ªç³»ç»Ÿæ”¯æŒ5ç§ä¸»æµGitå¹³å°
- **ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„**: æ¸…æ™°çš„åˆ†å±‚è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **âš¡ æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨æ£€æµ‹å’Œè·¯ç”±åˆ°æ­£ç¡®çš„é€‚é…å™¨
- **ğŸ”§ é…ç½®é©±åŠ¨**: çµæ´»çš„ç¯å¢ƒå˜é‡é…ç½®
- **ğŸ“Š å¯è§‚æµ‹æ€§**: å®Œæ•´çš„æ—¥å¿—ã€ç›‘æ§å’Œå¥åº·æ£€æŸ¥
- **ğŸš€ å³ç”¨æ€§**: å¼€ç®±å³ç”¨çš„webhookç«¯ç‚¹å’ŒAPI

è¿™ä¸ªå®ç°ä¸ºä¼ä¸šçº§ä»£ç å®¡æŸ¥æä¾›äº†å¼ºå¤§çš„å¤šå¹³å°ç»Ÿä¸€æ¥å…¥èƒ½åŠ›ï¼Œå¤§å¤§æå‡äº†å¼€å‘å›¢é˜Ÿçš„æ•ˆç‡å’Œä»£ç è´¨é‡ç®¡ç†æ°´å¹³ï¼
