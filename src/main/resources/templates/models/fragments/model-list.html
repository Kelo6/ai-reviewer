<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<!-- æ¨¡å‹åˆ—è¡¨ç‰‡æ®µ -->
<div th:fragment="model-list">
    <div th:if="${models != null and !models.isEmpty()}" class="model-grid">
        <div th:each="model : ${models}" class="model-card" th:attr="data-type=${model.type.code}">
            <!-- å¯ç”¨/ç¦ç”¨å¼€å…³ -->
            <div class="toggle-switch">
                <input type="checkbox" th:id="'toggle-' + ${model.id}" 
                       th:checked="${model.enabled}"
                       th:onchange="'toggleModel(\'' + ${model.id} + '\')'">
                <label th:for="'toggle-' + ${model.id}"></label>
            </div>
            
            <div class="model-header">
                <div class="model-info">
                    <div class="model-title">
                        <span class="model-icon" th:text="${model.typeIcon}">ğŸ¤–</span>
                        <h3 class="model-name" th:text="${model.displayName ?: model.name}">æ¨¡å‹åç§°</h3>
                    </div>
                    <div class="model-type" th:text="${model.type.displayName}">æ¨¡å‹ç±»å‹</div>
                    <div class="model-status" 
                         th:classappend="'status-' + ${model.status.code}">
                        <span th:text="${model.statusIcon}">âœ…</span>
                        <span th:text="${model.status.displayName}">å·²è¿æ¥</span>
                    </div>
                </div>
            </div>
            
            <div class="model-description" th:if="${model.description}" 
                 th:text="${model.description}">æ¨¡å‹æè¿°</div>
            
            <!-- AIæ¨¡å‹ç»Ÿè®¡ -->
            <div th:if="${model.isAiModel()}" class="model-stats">
                <div class="model-stat" th:if="${model.totalRequests != null}">
                    <span>æ€»è¯·æ±‚æ•°</span>
                    <span th:text="${model.totalRequests ?: 0}">0</span>
                </div>
                <div class="model-stat" th:if="${model.totalRequests != null and model.totalRequests > 0}">
                    <span>æˆåŠŸç‡</span>
                    <span th:text="${#numbers.formatDecimal(model.successRate ?: 0, 0, 1)} + '%'">0%</span>
                </div>
                <div class="model-stat" th:if="${model.averageResponseTime != null}">
                    <span>å“åº”æ—¶é—´</span>
                    <span th:text="${#numbers.formatDecimal(model.averageResponseTime, 0, 0)} + 'ms'">0ms</span>
                </div>
                <div class="model-stat" th:if="${model.estimatedCost != null}">
                    <span>ä¼°ç®—æˆæœ¬</span>
                    <span th:text="'$' + ${#numbers.formatDecimal(model.estimatedCost, 0, 2)}">$0.00</span>
                </div>
            </div>
            
            <!-- é™æ€åˆ†æå·¥å…·ç»Ÿè®¡ -->
            <div th:if="${model.isStaticAnalyzer()}" class="model-stats">
                <div class="model-stat" th:if="${model.supportedLanguages != null}">
                    <span>æ”¯æŒè¯­è¨€</span>
                    <span th:text="${#lists.size(model.supportedLanguages)}">0</span>
                </div>
                <div class="model-stat" th:if="${model.supportedFileTypes != null}">
                    <span>æ–‡ä»¶ç±»å‹</span>
                    <span th:text="${#lists.size(model.supportedFileTypes)}">0</span>
                </div>
                <div class="model-stat" th:if="${model.totalRequests != null}">
                    <span>åˆ†ææ¬¡æ•°</span>
                    <span th:text="${model.totalRequests ?: 0}">0</span>
                </div>
                <div class="model-stat" th:if="${model.averageResponseTime != null}">
                    <span>å¹³å‡è€—æ—¶</span>
                    <span th:text="${#numbers.formatDecimal(model.averageResponseTime / 1000, 0, 1)} + 's'">0s</span>
                </div>
            </div>
            
            <div class="model-actions">
                <div class="model-actions-row">
                    <button class="btn-small btn-success" 
                            th:onclick="'testModel(\'' + ${model.id} + '\')'">
                        <span th:if="${model.isAiModel()}">ğŸ” æµ‹è¯•è¿æ¥</span>
                        <span th:if="${model.isStaticAnalyzer()}">ğŸ” æµ‹è¯•å·¥å…·</span>
                    </button>
                    <button class="btn-small" 
                            th:onclick="'editModel(\'' + ${model.id} + '\')'">
                        âœï¸ ç¼–è¾‘
                    </button>
                </div>
                <div class="model-actions-row">
                    <button class="btn-small" 
                            th:onclick="'showModelDetails(\'' + ${model.id} + '\')'">
                        ğŸ“Š è¯¦æƒ…
                    </button>
                    <button class="btn-small" 
                            th:onclick="'cloneModel(\'' + ${model.id} + '\')'">
                        ğŸ“‹ å¤åˆ¶
                    </button>
                </div>
                <div class="model-actions-row">
                    <button class="btn-small btn-danger" 
                            th:onclick="'deleteModel(\'' + ${model.id} + '\')'">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç©ºçŠ¶æ€ -->
    <div th:if="${models == null or models.isEmpty()}" class="empty-state">
        <div class="empty-state-icon">ğŸ¤–</div>
        <h3>æ²¡æœ‰æ‰¾åˆ°æ¨¡å‹</h3>
        <p>å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°æ¨¡å‹é…ç½®</p>
    </div>
</div>

<!-- é”™è¯¯çŠ¶æ€ -->
<div th:fragment="model-list-error">
    <div class="error-state">
        <div class="error-icon">âŒ</div>
        <h3>åŠ è½½å¤±è´¥</h3>
        <p th:text="${error}">åŠ è½½æ¨¡å‹åˆ—è¡¨æ—¶å‘ç”Ÿé”™è¯¯</p>
        <button class="btn btn-primary" onclick="location.reload()">
            ğŸ”„ é‡æ–°åŠ è½½
        </button>
    </div>
</div>

<style>
    .error-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #dc2626;
    }
    
    .error-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }
    
    .model-actions-row {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .model-actions-row:last-child {
        margin-bottom: 0;
    }
</style>

<script>
    // æ˜¾ç¤ºæ¨¡å‹è¯¦æƒ…
    function showModelDetails(modelId) {
        // å¯ä»¥åœ¨æ¨¡æ€æ¡†ä¸­æ˜¾ç¤ºè¯¦æƒ…ï¼Œæˆ–è€…è·³è½¬åˆ°è¯¦æƒ…é¡µé¢
        console.log('Show details for model:', modelId);
        
        // ç¤ºä¾‹ï¼šåœ¨æ¨¡æ€æ¡†ä¸­æ˜¾ç¤ºè¯¦æƒ…
        fetch(`/models/${modelId}/details`)
            .then(response => response.text())
            .then(html => {
                // åˆ›å»ºè¯¦æƒ…æ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">æ¨¡å‹è¯¦æƒ…</h2>
                            <button class="close-btn" onclick="this.closest('.modal-overlay').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${html}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // ç‚¹å‡»å¤–éƒ¨å…³é—­
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            })
            .catch(error => {
                console.error('Failed to load model details:', error);
                alert('åŠ è½½æ¨¡å‹è¯¦æƒ…å¤±è´¥');
            });
    }
</script>
</html>
