<!DOCTYPE html>
<html lang="zh-CN" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<!-- ä¸»å¯¼èˆªæ  -->
<nav th:fragment="main-navigation" class="navbar">
    <div class="container">
        <div class="navbar-content">
            <!-- å“ç‰ŒLogo -->
            <a class="navbar-brand" th:href="@{/dashboard}">
                ğŸ¤– AI Reviewer
            </a>
            
            <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <button class="navbar-toggle" onclick="toggleMobileMenu()">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>
            
            <!-- å¯¼èˆªèœå• -->
            <div class="navbar-menu" id="navbar-menu">
                <ul class="navbar-nav">
                    <!-- ä»ªè¡¨æ¿ -->
                    <li class="nav-item">
                        <a class="nav-link" 
                           th:href="@{/dashboard}"
                           th:classappend="${#request.requestURI == '/dashboard' or #request.requestURI == '/' ? 'active' : ''}">
                            <span class="nav-icon">ğŸ“Š</span>
                            <span class="nav-text">ä»ªè¡¨æ¿</span>
                        </a>
                    </li>
                    
                    <!-- é…ç½®ç®¡ç† -->
                    <li class="nav-item">
                        <a class="nav-link" 
                           th:href="@{/config}"
                           th:classappend="${#strings.startsWith(#request.requestURI, '/config') ? 'active' : ''}">
                            <span class="nav-icon">âš™ï¸</span>
                            <span class="nav-text">é…ç½®ç®¡ç†</span>
                        </a>
                    </li>
                    
                    <!-- æ¨¡å‹ç®¡ç† -->
                    <li class="nav-item">
                        <a class="nav-link" 
                           th:href="@{/models}"
                           th:classappend="${#strings.startsWith(#request.requestURI, '/models') ? 'active' : ''}">
                            <span class="nav-icon">ğŸ¤–</span>
                            <span class="nav-text">æ¨¡å‹ç®¡ç†</span>
                        </a>
                    </li>
                    
                    <!-- API æ–‡æ¡£ -->
                    <li class="nav-item">
                        <a class="nav-link" 
                           th:href="@{/api-docs}"
                           th:classappend="${#strings.startsWith(#request.requestURI, '/api-docs') ? 'active' : ''}">
                            <span class="nav-icon">ğŸ“–</span>
                            <span class="nav-text">APIæ–‡æ¡£</span>
                        </a>
                    </li>
                    
                    <!-- ç³»ç»Ÿç›‘æ§ -->
                    <li class="nav-item">
                        <a class="nav-link" 
                           th:href="@{/actuator/health}"
                           target="_blank">
                            <span class="nav-icon">ğŸ’»</span>
                            <span class="nav-text">ç³»ç»Ÿç›‘æ§</span>
                        </a>
                    </li>
                    
                    <!-- åˆ†éš”ç¬¦ -->
                    <li class="nav-divider"></li>
                    
                    <!-- ç”¨æˆ·ä¿¡æ¯ (ä»…ç™»å½•æ—¶æ˜¾ç¤º) -->
                    <li class="nav-item user-menu" sec:authorize="isAuthenticated()">
                        <div class="nav-link user-info" onclick="toggleUserMenu()">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span class="nav-text" sec:authentication="name">ç”¨æˆ·</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="user-dropdown" id="user-dropdown">
                            <a th:href="@{/profile}" class="dropdown-item">
                                <span class="dropdown-icon">ğŸ“‹</span>
                                ä¸ªäººèµ„æ–™
                            </a>
                            <a th:href="@{/settings}" class="dropdown-item">
                                <span class="dropdown-icon">âš™ï¸</span>
                                è®¾ç½®
                            </a>
                            <div class="dropdown-divider"></div>
                            <form th:action="@{/logout}" method="post" class="dropdown-form">
                                <button type="submit" class="dropdown-item logout-btn">
                                    <span class="dropdown-icon">ğŸšª</span>
                                    é€€å‡ºç™»å½•
                                </button>
                            </form>
                        </div>
                    </li>
                    
                    <!-- ç™»å½•æŒ‰é’® (æœªç™»å½•æ—¶æ˜¾ç¤º) -->
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-link btn-login" th:href="@{/login}">
                            <span class="nav-icon">ğŸ”</span>
                            <span class="nav-text">ç™»å½•</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<!-- é¢åŒ…å±‘å¯¼èˆª -->
<nav th:fragment="breadcrumb-navigation(breadcrumbs)" th:if="${breadcrumbs != null}" class="breadcrumb-nav">
    <div class="container">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a th:href="@{/dashboard}">ğŸ  é¦–é¡µ</a>
            </li>
            <li th:each="crumb, iterStat : ${breadcrumbs}" 
                class="breadcrumb-item"
                th:classappend="${iterStat.last ? 'active' : ''}">
                <a th:if="${!iterStat.last && crumb.url != null}" 
                   th:href="${crumb.url}" 
                   th:text="${crumb.text}">é“¾æ¥</a>
                <span th:if="${iterStat.last || crumb.url == null}" 
                      th:text="${crumb.text}">å½“å‰é¡µ</span>
            </li>
        </ol>
    </div>
</nav>

<!-- é¡µé¢æ ‡é¢˜æ  -->
<div th:fragment="page-header(title, subtitle, actions)" class="page-header">
    <div class="container">
        <div class="page-header-content">
            <div class="page-title-section">
                <h1 class="page-title" th:text="${title}">é¡µé¢æ ‡é¢˜</h1>
                <p th:if="${subtitle}" class="page-subtitle" th:text="${subtitle}">é¡µé¢å‰¯æ ‡é¢˜</p>
            </div>
            <div th:if="${actions}" class="page-actions" th:utext="${actions}">
                <!-- é¡µé¢æ“ä½œæŒ‰é’® -->
            </div>
        </div>
    </div>
</div>

<!-- å¯¼èˆªç›¸å…³çš„JavaScript -->
<script th:fragment="navigation-scripts">
    // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
    function toggleMobileMenu() {
        const menu = document.getElementById('navbar-menu');
        menu.classList.toggle('active');
    }
    
    // ç”¨æˆ·èœå•åˆ‡æ¢
    function toggleUserMenu() {
        const dropdown = document.getElementById('user-dropdown');
        dropdown.classList.toggle('active');
    }
    
    // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
    document.addEventListener('click', function(event) {
        const userMenu = document.querySelector('.user-menu');
        const dropdown = document.getElementById('user-dropdown');
        const mobileMenu = document.getElementById('navbar-menu');
        const toggleButton = document.querySelector('.navbar-toggle');
        
        // å…³é—­ç”¨æˆ·ä¸‹æ‹‰èœå•
        if (userMenu && !userMenu.contains(event.target)) {
            dropdown?.classList.remove('active');
        }
        
        // å…³é—­ç§»åŠ¨ç«¯èœå•
        if (toggleButton && !toggleButton.contains(event.target) && !mobileMenu?.contains(event.target)) {
            mobileMenu?.classList.remove('active');
        }
    });
    
    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // é«˜äº®å½“å‰é¡µé¢èœå•
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-link');
        
        navLinks.forEach(link => {
            const href = link.getAttribute('href');
            if (href && (currentPath === href || (href !== '/dashboard' && currentPath.startsWith(href)))) {
                link.classList.add('active');
            }
        });
    });
</script>

</html>
