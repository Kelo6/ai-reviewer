<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- 运行记录表格片段 -->
    <div th:fragment="runs-table">
        <div class="card">
            <div class="card-body">
                <table class="table" th:if="${runs != null and !runs.empty}">
                    <thead>
                        <tr>
                            <th>运行ID</th>
                            <th>仓库</th>
                            <th>PR</th>
                            <th>平台</th>
                            <th>总分</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="run : ${runs}">
                            <td>
                                <code class="text-small" th:text="${#strings.abbreviate(run.runId, 12)}">run-001</code>
                            </td>
                            <td>
                                <a th:href="@{'https://github.com/' + ${run.repoOwner} + '/' + ${run.repoName}}" 
                                   target="_blank"
                                   class="text-primary">
                                    <span th:text="${run.repoOwner + '/' + run.repoName}">user/repo</span>
                                </a>
                            </td>
                            <td>
                                <div>
                                    <span class="badge badge-secondary" th:text="'#' + ${run.pullNumber}">#123</span>
                                </div>
                                <div class="text-small text-muted mt-1" th:text="${#strings.abbreviate(run.pullTitle, 30)}">
                                    PR标题
                                </div>
                            </td>
                            <td>
                                <span class="badge badge-info" th:text="${run.platform}">GitHub</span>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:classappend="${run.totalScore >= 90 ? 'badge-success' : (run.totalScore >= 70 ? 'badge-warning' : 'badge-error')}"
                                      th:text="${#numbers.formatDecimal(run.totalScore, 1, 1)}">
                                    85.5
                                </span>
                            </td>
                            <td class="text-small text-muted">
                                <time th:text="${#temporals.format(run.createdAt, 'MM-dd HH:mm')}">
                                    01-15 10:30
                                </time>
                            </td>
                            <td>
                                <div class="btn-group-sm">
                                    <a th:href="@{'/runs/' + ${run.runId}}" 
                                       class="btn btn-outline btn-sm">
                                        📊 查看详情
                                    </a>
                                    <button type="button" 
                                            class="btn btn-primary btn-sm"
                                            th:attr="onclick='generateReport(' + '&quot;' + ${run.runId} + '&quot;' + ')'">
                                        📄 生成报告
                                    </button>
                                    <a th:href="@{'/api/reports/' + ${run.runId} + '.md'}"
                                       class="btn btn-secondary btn-sm"
                                       download>
                                        📥 下载
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- 空状态 -->
                <div th:if="${runs == null or runs.empty}" class="text-center text-muted" style="padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">📋</div>
                    <h3>暂无运行记录</h3>
                    <p>还没有任何代码评审运行记录</p>
                </div>
            </div>
        </div>
        
        <!-- 分页 -->
        <div th:if="${runs != null and !runs.empty}" class="pagination">
            <button type="button" 
                    class="btn btn-secondary"
                    th:disabled="${!hasPrevious}"
                    hx-get="/dashboard/page"
                    hx-vals='{"page": "0", "size": "10"}'
                    hx-target="#runs-table-container"
                    hx-indicator="#loading-indicator">
                ← 上一页
            </button>
            
            <span class="page-info">
                第 <span th:text="${currentPage + 1}">1</span> 页，共 <span th:text="${totalPages}">1</span> 页
                （共 <span th:text="${totalElements}">0</span> 条记录）
            </span>
            
            <button type="button" 
                    class="btn btn-secondary"
                    th:disabled="${!hasNext}"
                    hx-get="/dashboard/page"
                    hx-vals='{"page": "1", "size": "10"}'
                    hx-target="#runs-table-container"
                    hx-indicator="#loading-indicator">
                下一页 →
            </button>
        </div>
    </div>
    
    <!-- 错误片段 -->
    <div th:fragment="error">
        <div class="card">
            <div class="card-body">
                <div class="text-center text-muted" style="padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>
                    <h3>加载失败</h3>
                    <p th:text="${error}">数据加载出现问题，请刷新页面重试</p>
                    <button onclick="location.reload()" class="btn btn-primary mt-2">刷新页面</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
