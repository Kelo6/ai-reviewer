# ğŸ”— AI Code Reviewer å¤šä»“åº“é€‚é…å™¨ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

AI Code Reviewer ç°å·²æ”¯æŒå¤šç§ Git å¹³å°çš„ç»Ÿä¸€æ¥å…¥ï¼Œæä¾›ä¸€è‡´çš„ AI ä»£ç å®¡æŸ¥ä½“éªŒï¼š

### âœ… æ”¯æŒçš„å¹³å°

| å¹³å° | çŠ¶æ€ | è®¤è¯æ–¹å¼ | Webhook æ”¯æŒ |
|------|------|----------|-------------|
| **GitHub** | âœ… å®Œæ•´æ”¯æŒ | Token / App | âœ… |
| **GitLab** | âœ… å®Œæ•´æ”¯æŒ | Token / OAuth | âœ… |
| **Bitbucket** | âœ… åŸºç¡€æ”¯æŒ | App Password | âœ… |
| **Gitea** | ğŸš§ å¼€å‘ä¸­ | Token | âœ… |
| **è‡ªå»º Git** | ğŸš§ å¼€å‘ä¸­ | Token | âœ… |

## ğŸ› ï¸ é…ç½®æ–¹å¼

### 1. GitHub é…ç½®

```yaml
ai-reviewer:
  scm:
    github:
      api-base: https://api.github.com
      web-base: https://github.com
      token: ${GITHUB_TOKEN}
      client-id: ${GITHUB_CLIENT_ID}
      client-secret: ${GITHUB_CLIENT_SECRET}
      webhook-secret: ${GITHUB_WEBHOOK_SECRET}
```

**ç¯å¢ƒå˜é‡ï¼š**
```bash
export GITHUB_TOKEN="ghp_your_github_token"
export GITHUB_CLIENT_ID="your_github_app_client_id"
export GITHUB_CLIENT_SECRET="your_github_app_client_secret"
export GITHUB_WEBHOOK_SECRET="your_webhook_secret"
```

### 2. GitLab é…ç½®

```yaml
ai-reviewer:
  scm:
    gitlab:
      api-base: https://gitlab.com/api/v4
      web-base: https://gitlab.com
      token: ${GITLAB_TOKEN}
      client-id: ${GITLAB_CLIENT_ID}
      client-secret: ${GITLAB_CLIENT_SECRET}
      webhook-secret: ${GITLAB_WEBHOOK_SECRET}
```

**ç¯å¢ƒå˜é‡ï¼š**
```bash
export GITLAB_TOKEN="glpat_your_gitlab_token"
export GITLAB_CLIENT_ID="your_gitlab_app_client_id"
export GITLAB_CLIENT_SECRET="your_gitlab_app_client_secret"
export GITLAB_WEBHOOK_SECRET="your_webhook_secret"
```

### 3. Bitbucket é…ç½®

```yaml
ai-reviewer:
  scm:
    bitbucket:
      api-base: https://api.bitbucket.org/2.0
      web-base: https://bitbucket.org
      username: ${BITBUCKET_USERNAME}
      app-password: ${BITBUCKET_APP_PASSWORD}
      webhook-secret: ${BITBUCKET_WEBHOOK_SECRET}
```

**ç¯å¢ƒå˜é‡ï¼š**
```bash
export BITBUCKET_USERNAME="your_bitbucket_username"
export BITBUCKET_APP_PASSWORD="your_app_password"
export BITBUCKET_WEBHOOK_SECRET="your_webhook_secret"
```

### 4. Gitea é…ç½®

```yaml
ai-reviewer:
  scm:
    gitea:
      api-base: ${GITEA_API_BASE}  # ä¾‹å¦‚: https://gitea.example.com/api/v1
      web-base: ${GITEA_WEB_BASE}  # ä¾‹å¦‚: https://gitea.example.com
      token: ${GITEA_TOKEN}
      webhook-secret: ${GITEA_WEBHOOK_SECRET}
      ssl-verify: ${GITEA_SSL_VERIFY:true}
```

**ç¯å¢ƒå˜é‡ï¼š**
```bash
export GITEA_API_BASE="https://gitea.example.com/api/v1"
export GITEA_WEB_BASE="https://gitea.example.com"
export GITEA_TOKEN="your_gitea_token"
export GITEA_WEBHOOK_SECRET="your_webhook_secret"
export GITEA_SSL_VERIFY="true"
```

### 5. è‡ªå»º Git é…ç½®

```yaml
ai-reviewer:
  scm:
    custom-git:
      api-base: ${CUSTOM_GIT_API_BASE}
      web-base: ${CUSTOM_GIT_WEB_BASE}
      token: ${CUSTOM_GIT_TOKEN}
      webhook-secret: ${CUSTOM_GIT_WEBHOOK_SECRET}
      ssl-verify: ${CUSTOM_GIT_SSL_VERIFY:true}
      api-type: ${CUSTOM_GIT_API_TYPE:gitea}  # gitea, gitlab, github
```

**ç¯å¢ƒå˜é‡ï¼š**
```bash
export CUSTOM_GIT_API_BASE="https://git.yourcompany.com/api/v1"
export CUSTOM_GIT_WEB_BASE="https://git.yourcompany.com"
export CUSTOM_GIT_TOKEN="your_git_token"
export CUSTOM_GIT_WEBHOOK_SECRET="your_webhook_secret"
export CUSTOM_GIT_SSL_VERIFY="true"
export CUSTOM_GIT_API_TYPE="gitea"  # æ ¹æ®å®é™…APIå…¼å®¹æ€§é€‰æ‹©
```

## ğŸ”— Webhook ç«¯ç‚¹

### ç»Ÿä¸€ Webhook ç«¯ç‚¹

| å¹³å° | Webhook URL | ç¤ºä¾‹ |
|------|-------------|------|
| **GitHub** | `POST /api/webhooks/github` | `https://your-ai-reviewer.com/api/webhooks/github` |
| **GitLab** | `POST /api/webhooks/gitlab` | `https://your-ai-reviewer.com/api/webhooks/gitlab` |
| **Bitbucket** | `POST /api/webhooks/bitbucket` | `https://your-ai-reviewer.com/api/webhooks/bitbucket` |
| **Gitea** | `POST /api/webhooks/gitea` | `https://your-ai-reviewer.com/api/webhooks/gitea` |
| **é€šç”¨** | `POST /api/webhooks/generic` | `https://your-ai-reviewer.com/api/webhooks/generic` |

### Webhook äº‹ä»¶æ”¯æŒ

| äº‹ä»¶ç±»å‹ | GitHub | GitLab | Bitbucket | Gitea |
|---------|--------|--------|-----------|-------|
| **Pull Request Opened** | âœ… | âœ… | âœ… | âœ… |
| **Pull Request Updated** | âœ… | âœ… | âœ… | âœ… |
| **Pull Request Closed** | âœ… | âœ… | âœ… | âœ… |
| **Push Events** | âœ… | âœ… | âœ… | âœ… |

## ğŸš€ API ç«¯ç‚¹

### æ”¯æŒçš„æä¾›å•†æŸ¥è¯¢

```bash
GET /api/webhooks/providers
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "supported": ["github", "gitlab", "bitbucket", "gitea", "custom-git"],
    "health": {
      "github": true,
      "gitlab": true,
      "bitbucket": true,
      "gitea": false,
      "custom-git": false
    },
    "adapters": {
      "github": "GithubAdapter",
      "gitlab": "GitlabAdapter",
      "bitbucket": "BitbucketAdapter",
      "gitea": "GiteaAdapter",
      "custom-git": "CustomGitAdapter"
    }
  }
}
```

### ä»“åº“æ”¯æŒæ£€æŸ¥

```bash
GET /api/webhooks/check-support?repoUrl=https://github.com/owner/repo
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "repoUrl": "https://github.com/owner/repo",
    "supported": true,
    "supportedProviders": ["github", "gitlab", "bitbucket", "gitea", "custom-git"]
  }
}
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. GitHub ä»“åº“

```bash
# é…ç½® webhook
curl -X POST https://api.github.com/repos/owner/repo/hooks \
  -H "Authorization: token $GITHUB_TOKEN" \
  -d '{
    "name": "web",
    "active": true,
    "events": ["pull_request"],
    "config": {
      "url": "https://your-ai-reviewer.com/api/webhooks/github",
      "content_type": "json",
      "secret": "your_webhook_secret"
    }
  }'
```

### 2. GitLab ä»“åº“

```bash
# é…ç½® webhook  
curl -X POST https://gitlab.com/api/v4/projects/:id/hooks \
  -H "PRIVATE-TOKEN: $GITLAB_TOKEN" \
  -d '{
    "url": "https://your-ai-reviewer.com/api/webhooks/gitlab",
    "merge_requests_events": true,
    "push_events": true,
    "token": "your_webhook_secret"
  }'
```

### 3. Bitbucket ä»“åº“

```bash
# é…ç½® webhook
curl -X POST https://api.bitbucket.org/2.0/repositories/owner/repo/hooks \
  -u "$BITBUCKET_USERNAME:$BITBUCKET_APP_PASSWORD" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "AI Code Reviewer",
    "url": "https://your-ai-reviewer.com/api/webhooks/bitbucket",
    "active": true,
    "events": ["pullrequest:created", "pullrequest:updated"]
  }'
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Webhook ç­¾åéªŒè¯å¤±è´¥**
   - æ£€æŸ¥ webhook secret é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ webhook URL å’Œ secret åœ¨å¹³å°é…ç½®ä¸­ä¸€è‡´

2. **API è®¤è¯å¤±è´¥**
   - éªŒè¯ token æ˜¯å¦æœ‰æ•ˆä¸”æœ‰è¶³å¤Ÿæƒé™
   - æ£€æŸ¥ API base URL æ˜¯å¦æ­£ç¡®

3. **è‡ªå»º Git æœåŠ¡å™¨è¿æ¥å¤±è´¥**
   - ç¡®è®¤ API type é…ç½®æ­£ç¡®ï¼ˆgitea/gitlab/githubï¼‰
   - æ£€æŸ¥ SSL è¯ä¹¦é…ç½®
   - éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### è°ƒè¯•æ—¥å¿—

å¯ç”¨è°ƒè¯•æ—¥å¿—æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š

```yaml
logging:
  level:
    com.ai.reviewer.backend.infra.adapter: DEBUG
    com.ai.reviewer.backend.api.controller.WebhookController: DEBUG
```

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰é€‚é…å™¨çŠ¶æ€
GET /api/webhooks/providers

# æ£€æŸ¥ç‰¹å®šä»“åº“æ”¯æŒ
GET /api/webhooks/check-support?repoUrl=YOUR_REPO_URL
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

AI Code Reviewer æä¾›ä»¥ä¸‹ç›‘æ§æŒ‡æ ‡ï¼š

- **é€‚é…å™¨å¥åº·çŠ¶æ€**: å„å¹³å°é€‚é…å™¨çš„è¿æ¥çŠ¶æ€
- **Webhook å¤„ç†ç»Ÿè®¡**: æ¥æ”¶å’Œå¤„ç†çš„ webhook æ•°é‡
- **API è°ƒç”¨ç»Ÿè®¡**: å„å¹³å° API è°ƒç”¨æˆåŠŸç‡å’Œå»¶è¿Ÿ
- **å®¡æŸ¥ä»»åŠ¡ç»Ÿè®¡**: è§¦å‘å’Œå®Œæˆçš„å®¡æŸ¥ä»»åŠ¡æ•°é‡

## ğŸ”„ å‡çº§å’Œç»´æŠ¤

### ç‰ˆæœ¬å…¼å®¹æ€§

| AI Reviewer ç‰ˆæœ¬ | æ”¯æŒçš„å¹³å°ç‰ˆæœ¬ |
|------------------|---------------|
| **1.0.0+** | GitHub API v4, GitLab API v4, Bitbucket API v2.0, Gitea API v1 |

### é…ç½®è¿ç§»

ä»å•å¹³å°é…ç½®è¿ç§»åˆ°å¤šå¹³å°é…ç½®æ—¶ï¼Œåªéœ€ï¼š

1. ä¿æŒåŸæœ‰é…ç½®ä¸å˜
2. æ·»åŠ æ–°å¹³å°çš„é…ç½®å—
3. é‡å¯æœåŠ¡ï¼Œæ–°é…ç½®è‡ªåŠ¨ç”Ÿæ•ˆ

### æ€§èƒ½ä¼˜åŒ–

- **è¿æ¥æ± é…ç½®**: æ ¹æ®ä½¿ç”¨é‡è°ƒæ•´ HTTP è¿æ¥æ± å¤§å°
- **ç¼“å­˜ç­–ç•¥**: å¯ç”¨ API å“åº”ç¼“å­˜å‡å°‘è°ƒç”¨æ¬¡æ•°
- **æ‰¹é‡å¤„ç†**: å¯¹äºå¤§é‡ webhook äº‹ä»¶ï¼Œå¯ç”¨æ‰¹é‡å¤„ç†æ¨¡å¼
